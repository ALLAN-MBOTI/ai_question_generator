ðŸ“š Phase 6: Backend Architecture and API Contracts

This section defines the backend structure, data storage plan, and the API endpoints that the Flutter frontend will consume.

1. Architecture Overview

Component

Technology

Role

Server

Google Cloud Functions / Python (Flask)

Handles all business logic, user authentication, calls to the Gemini API, and communication with Firestore.

Database

Firestore (NoSQL)

Stores user profiles, performance records, and potentially saved/shared question sets.

AI Layer

Gemini API (gemini-2.5-flash-preview-09-2025)

Generates the structured quiz questions and answers based on user input.

Auth

Firebase Authentication

Manages user identity (userId) for securing data access in Firestore.

2. API Contracts (Endpoints)

All endpoints will be secured and require a valid Firebase Auth token.

A. Generate Questions (Core AI Function)

This is the primary endpoint for creating a new quiz.

Endpoint: POST /api/v1/generate-quiz

Request Body (application/json):

{
"topic": "The process of photosynthesis in plants.",
"gradeLevel": "High School",
"numQuestions": 5,
"questionType": "Multiple Choice"
}

Response Body (200 OK):
Returns a structured list of questions that matches the Flutter Question model (before code generation).

[
{
"id": "q1",
"questionText": "What is the primary function of chlorophyll in photosynthesis?",
"options": ["Absorbing blue light", "Transporting water", "Capturing sunlight energy", "Producing glucose"],
"correctAnswer": "Capturing sunlight energy",
"explanation": "Chlorophyll is the pigment responsible for capturing the light energy needed to power photosynthesis."
},
// ... more questions
]

B. Save Performance Report

Used after a user completes a quiz to record their score.

Endpoint: POST /api/v1/save-performance

Request Body (application/json): Matches the Flutter Performance model structure.

{
"studentId": "user-abc-123",
"studentName": "John Doe",
"topic": "The process of photosynthesis...",
"totalQuestions": 5,
"score": 4,
"details": [
{
"questionId": "q1",
"chosenAnswer": "Capturing sunlight energy",
"correctAnswer": "Capturing sunlight energy",
"isCorrect": true
},
// ... more details
]
}

Response Body (201 Created):

{
"status": "success",
"message": "Performance record saved.",
"recordId": "perf-xyz-456"
}

C. Get Performance History

Retrieves all past performance records for the authenticated user.

Endpoint: GET /api/v1/performance-history

Request Body: None (User ID is derived from the auth token)

Response Body (200 OK):
Returns a list of performance objects, similar to the request body of the save endpoint, but with the added server-generated id and date.

[
{ "id": "perf-xyz-456", "date": "2024-11-05T10:00:00Z", ... },
{ "id": "perf-def-789", "date": "2024-11-04T09:30:00Z", ... }
]

3. Data Storage (Firestore Structure)

Data will be stored in a collection named performance_reports. The document ID will be automatically generated by Firestore.

Collection

Document ID

Fields (Data Model)

Security

performance_reports

Auto-ID (e.g., perf-xyz)

studentId (string), studentName (string), date (timestamp), topic (string), totalQuestions (int), score (int), details (array of QuestionResult maps)

Private (Read/Write only by the authenticated studentId)
